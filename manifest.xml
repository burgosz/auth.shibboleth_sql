<?xml version="1.0" encoding="UTF-8"?>
<authdriver name="shibboleth" label="CONF_MESSAGE[Shibboleth authentication with DB]" description="CONF_MESSAGE[Stores the Authentication data as serialized PHP values on the filesystem.]" mixins="authdriver_commons"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:../core.ajaxplorer/ajxp_registry.xsd">
    <client_settings>
        <resources>
            <i18n namespace="serial_auth" path="plugins/auth.serial/i18n"/>
        </resources>
    </client_settings>
	<server_settings>
		<param name="LOGOUT_URL" type="string" label="CONF_MESSAGE[Logout URL]" description="CONF_MESSAGE[Redirect to the given URL on loggin out]" mandatory="false" />
        <param name="ADMIN_ENTITLEMENT" type="string" label="CONF_MESSAGE[Admin entitlement]" description="CONF_MESSAGE[Redirect to the given URL on loggin out]" mandatory="false" />
        <param name="SQL_DRIVER" type="group_switch:dibi" label="CONF_MESSAGE[Connexion]" description="CONF_MESSAGE[The Database Connexion]" mandatory="true"/>
        <param type="button" name="INSTALL_SQL" choices="run_plugin_action:auth.sql:installSQLTables" label="CONF_MESSAGE[SQL Tables]" description="CONF_MESSAGE[Install SQL Tables]" mandatory="false"/>
	</server_settings>
	<class_definition filename="plugins/auth.shibboleth_sql/class.shibboleth_sqlAuthDriver.php" classname="shibboleth_sqlAuthDriver"/>

	<registry_contributions>
		<external_file filename="plugins/core.auth/standard_auth_actions.xml" include="actions/*" exclude="actions/action[@name='logout']"/>
        <external_file filename="plugins/auth.shibboleth_sql/shibboleth_sqlAuthActions.xml" include="actions/*"/>
<!--			<action name="logout" expireDefault="true">
                <gui text="164" title="169" src="decrypted.png" accessKey="" hasAccessKey="false">
                    				<context selection="false" dir="" recycle="false"
					actionBar="false" contextMenu="false" infoPanel="false"
                    ajxpWidgets="UserWidget::logging_string">
				
                    </context>
                </gui>
                <rightsContext noUser="false" userLogged="only" guestLogged="show" read="false" write="false" adminOnly=""/>
                <processing>
                    <clientCallback prepareModal="false"><![CDATA[
                        clearRememberData();
                        var connexion = new Connexion();
                        connexion.addParameter('get_action', 'logout');
                        connexion.onComplete = function(transport){
                                var child = transport.responseXML.documentElement.childNodes;
                                try{
                                    document.location.href = "/Shibboleth.sso/Logout";
                                }catch(e){}
                        };
                        connexion.sendAsync();
                        ]]></clientCallback>
                    <serverCallback methodName="switchAction"/>
                </processing>
            </action>
-->
	</registry_contributions>

	<dependencies>
		<pluginClass pluginName="auth.sql"/>
	</dependencies>
</authdriver>
